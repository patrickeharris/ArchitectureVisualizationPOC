<head>
    <style> body { margin: 0; } </style>

    <script src="//unpkg.com/3d-force-graph"></script>
    <!--<script src="../../dist/3d-force-graph.js"></script>-->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
<div class="center">
    <div class="search-box">
        <input type="text" placeholder="what are you looking for?">
        <i class="fas fa-search"></i>
        <div class="autocom_box">
            <li>Happy</li>
        </div>
    </div>
</div>
<div id="3d-graph"></div>

<script>
    const highlightNodes = new Set();
    const highlightLinks = new Set();
    let hoverNode = null;

    const Graph = ForceGraph3D()
    (document.getElementById('3d-graph'))
        .jsonUrl('./data.json')
        .nodeLabel('id')
        .nodeColor(node => highlightNodes.has(node) ? node === hoverNode ? 'rgb(255,0,0,1)' : 'rgba(255,160,0,0.8)' : 'rgba(0,255,255,0.6)')
        .linkWidth(link => highlightLinks.has(link) ? 4 : 1)
        .nodeAutoColorBy('group')
        .linkDirectionalParticles(link => highlightLinks.has(link) ? 4 : 0)
        .linkDirectionalParticleWidth(4)
        .onNodeDragEnd(node => {
            node.fx = node.x;
            node.fy = node.y;
            node.fz = node.z;

        })
        .onNodeClick(node => {
            // Aim at node from outside it
            const distance = 40;
            const distRatio = 1 + distance/Math.hypot(node.x, node.y, node.z);

            const newPos = node.x || node.y || node.z
                ? { x: node.x * distRatio, y: node.y * distRatio, z: node.z * distRatio }
                : { x: 0, y: 0, z: distance }; // special case if node is in (0,0,0)

            Graph.cameraPosition(
                newPos, // new position
                node, // lookAt ({ x, y, z })
                3000  // ms transition duration
            );
        })
        .onNodeHover(node => {
            // no state change
            if ((!node && !highlightNodes.size) || (node && hoverNode === node)) return;

            highlightNodes.clear();
            highlightLinks.clear();
            if (node) {
                highlightNodes.add(node);
                var request = new XMLHttpRequest();
                request.open("GET", "./data.json", false);
                request.send(null)
                let result = JSON.parse(request.responseText);
                console.log(node.id)
                //result.links.forEach(function(neighbor){if(neighbor.source === node || neighbor.target === node){highlightNodes.add(neighbor)}});
                result.links.forEach(function(link){if(link.source === node.id || link.target === node.id) {
                    highlightLinks.add(link);
                    highlightNodes.add(link.source);
                    highlightNodes.add(link.target);
                    console.log("Yeye");
                }});
                /*result.nodes.forEach(function(nodel){
                    highlightLinks.forEach(function(link){
                        if(link.source === nodel.id || link.target === nodel.id){
                            console.log("Ye")
                            if(!highlightNodes.has(nodel)){
                                console.log("yes")
                                highlightNodes.add(nodel.id)
                            }
                        }
                    })
                });*/
            }

            hoverNode = node || null;

            updateHighlight();
        })
        .onLinkHover(link => {
            highlightNodes.clear();
            highlightLinks.clear();

            if (link) {
                highlightLinks.add(link);
                highlightNodes.add(link.source);
                highlightNodes.add(link.target);
            }

            updateHighlight();
        });


    function updateHighlight() {
        // trigger update of highlighted objects in scene
        Graph
            .nodeColor(Graph.nodeColor())
            .linkWidth(Graph.linkWidth())
            .linkDirectionalParticles(Graph.linkDirectionalParticles());
    }
</script>
</body>